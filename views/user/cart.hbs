<div class="container mt-5">
  <h2 class="text-center mb-4">Your Cart</h2>
  
  <!-- Show the message if present -->
  {{#if message}}
    <div class="alert alert-info">{{message}}</div>
  {{/if}}

  <div class="table-responsive">
    {{#if cartItems.length}}
    <table class="table table-striped table-bordered table-hover text-center">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Image</th>
          <th scope="col">Name</th>
          <th scope="col">Quantity</th>
          <th scope="col">Price</th>
          <th scope="col">Total</th>
          <th scope="col">Remove</th>
        </tr>
      </thead>
      <tbody>
        {{#each cartItems}}
        <tr data-product-id="{{this._id}}" data-price="{{this.price}}">
          <td>
            <img src="{{this.imagePath}}" alt="{{this.productName}}" class="cart-product-image img-thumbnail" />
          </td>
          <td>{{this.productName}}</td>
          <td>
            <div class="input-group quantity-group">
              <button class="btn btn-sm btn-outline-secondary decrement-btn" type="button">-</button>
              <input type="number" value="{{this.quantity}}" min="1" class="form-control quantity-input text-center" />
              <button class="btn btn-sm btn-outline-secondary increment-btn" type="button">+</button>
            </div>
          </td>
          <td>₹{{this.price}}</td>
          <td class="product-total">₹{{this.total}}</td>
          <td>
            <!-- Remove button -->
            <form action="/remove-from-cart" method="POST" class="remove-item-form">
              <input type="hidden" name="productId" value="{{this._id}}">
<button class="btn btn-danger remove-btn" data-product-id="{{this._id}}">Remove</button>
            </form>
          </td>
        </tr>
        {{/each}}
      </tbody>
      <tfoot>
        <tr class="table-primary">
          <td colspan="4" class="text-right"><strong>Total Price</strong></td>
          <td colspan="2" id="grandTotal">₹{{totalPrice}}</td>
        </tr>
      </tfoot>
    </table>

    <!-- Proceed to Payment Button -->
    <div class="text-right mt-4">
      <form action="/payment" method="POST">
        <input type="hidden" name="cartDetails" id="cartDetailsInput" />
        <button type="submit" class="btn btn-primary btn-lg">Proceed to Payment</button>
      </form>
    </div>
    {{else}}
    <!-- Message when no items are in the cart -->
    <div class="text-center mt-5">
      <h4>Your cart is empty. Add items to your cart to proceed.</h4>
      <a href="/" class="btn btn-primary mt-3">Go Shopping</a>
    </div>
    {{/if}}
  </div>
</div>

<style>
  /* Custom Styles */
  .cart-product-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
  }

  .quantity-group {
    width: 120px;
    margin: auto;
  }

  .quantity-input {
    width: 60px;
  }

  .product-total {
    font-weight: bold;
  }

  .table th, .table td {
    vertical-align: middle;
  }

  tfoot td {
    font-size: 1.2em;
    font-weight: bold;
  }

  .btn-lg {
    padding: 12px 24px;
    font-size: 18px;
  }

  .text-center h4 {
    color: #ff6f61;
  }

  .text-center a {
    text-decoration: none;
  }

  .text-right .btn-primary {
    width: 200px;
    font-size: 18px;
    padding: 10px 20px;
  }

  .table-primary {
    background-color: #f8f9fa;
  }

  /* Custom styling for Remove button */
  .btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
  }

  .btn-danger:hover {
    background-color: #c82333;
    border-color: #bd2130;
  }
</style>

<script>
  $('.remove-btn').click(function() {
    const productId = $(this).data('product-id');
    $.ajax({
        url: '/remove-from-cart',
        method: 'POST',
        data: { productId: productId }, // Ensure productId is being sent
        success: function(response) {
            // Handle success (e.g., redirect or refresh the cart)
        },
        error: function(error) {
            // Handle error
        }
    });
});

</script>