<div class="container mt-4">
    <h2 class="text-center mb-4">My Wishlist</h2>

    <div id="alert-box" class="alert alert-success text-center d-none"></div>

    {{#if error}}
        <div class="alert alert-danger text-center">{{error}}</div>
    {{/if}}

    <div class="row">
        {{#each products}}
            <div class="col-md-4" id="wishlist-item-{{this._id}}">
                <div class="card wishlist-card shadow-sm">
                    <img src="{{this.imagePath}}" class="card-img-top wishlist-img" alt="{{this.name}}">
                    <div class="card-body text-center">
                        <h5 class="card-title">{{this.name}}</h5>
                        <p class="text-muted">{{this.category}}</p>
                        <p class="fw-bold text-success">â‚¹{{this.price}}</p>
                        <p class="card-text">{{this.description}}</p>

                        <!-- Remove from Wishlist (AJAX) -->
                        <button type="button" class="btn btn-danger" onclick="removeFromWishlist('{{this._id}}', '{{this.name}}')">
                            <i class="fas fa-trash-alt"></i> Remove
                        </button>

                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</div>

<!-- Styles -->
<style>
    .wishlist-card {
        border-radius: 10px;
        overflow: hidden;
        transition: 0.3s;
    }
    .wishlist-card:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .wishlist-img {
        height: 200px;
        object-fit: cover;
    }
    .btn-danger {
        font-size: 14px;
        padding: 8px 12px;
    }
</style>

<!-- JavaScript -->
<script>
function removeFromWishlist(productId, productName) {
    fetch('/remove-from-wishlist', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show Bootstrap alert box
            const alertBox = document.getElementById("alert-box");
            alertBox.textContent = `Removed "${productName}" from wishlist`;
            alertBox.classList.remove("d-none");
            alertBox.classList.add("show");

            // Remove the product from the UI without refreshing
            const productCard = document.getElementById(`wishlist-item-${productId}`);
            if (productCard) {
                productCard.remove();
            }
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(error => {
        console.error("Error removing from wishlist:", error);
        alert("An error occurred. Please try again.");
    });
}

</script>
